name: achat

services:
  postgres:
    container_name: achat-postgres
    image: timescale/timescaledb-ha:pg${POSTGRES_VERSION:-17}
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-postgres}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      POSTGRES_DB: ${POSTGRES_DB:-postgres}
    expose:
      - 5432
    volumes:
      - postgres-data:/home/postgres/pgdata/data
    restart: always

  electric:
    image: electricsql/electric
    environment:
      DATABASE_URL: postgresql://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-postgres}@postgres:5432/${POSTGRES_DB:-postgres}?sslmode=disable
      # Not suitable for production. Only use insecure mode in development or if you've otherwise secured the Electric API.
      # See https://electric-sql.com/docs/guides/security
      ELECTRIC_INSECURE: true
      ELECTRIC_PORT: 5433
    expose:
      - 5433
    depends_on:
      - postgres

  redis:
    container_name: achat-redis
    image: ${REDIS_IMAGE:-redis:7}
    environment:
      - "REDIS_ARGS=--appendonly yes"
    expose:
      - 6379
    volumes:
      - redis-data:/data
    restart: always

  inngest:
    container_name: achat-inngest
    image: ${INNGEST_IMAGE:-inngest/inngest}
    command: ["inngest", "start", "--sdk-url", "http://host.docker.internal:3001/api/inngest"]
    environment:
      # INNGEST_EVENT_KEY: 
      # INNGEST_SIGNING_KEY:
      INNGEST_SQLITE_DIR: /data
    expose:
      - 8288
    volumes:
      - inngest-data:/data

  minio:
    container_name: achat-minio
    image: ${MINIO_IMAGE:-minio/minio}
    volumes:
      - minio-data:/data
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin
    command: server /data --console-address ":9001"
    expose:
      - 9000
      - 9001
      
volumes:
  postgres-data:
  redis-data:
  inngest-data:
  minio-data: